{"version":3,"file":"static/js/4218.9300f594.chunk.js","mappings":"6mDAmBaA,GAA2BC,EAAAA,EAAAA,GAAiC,CACvEC,WAAY,GACZC,QAAS,KACTC,kBASF,WACE,IACE,OAAOC,KAAKC,MAAMC,EAAAA,EAAcC,UAAUC,EAAAA,G,CAC1C,MAAOC,GACP,OAAO,I,CAEX,CAfqBC,GACnBC,WAAY,CAAC,EACbC,gBAAiB,CAAEC,QAAS,MAG9Bd,EAAyBe,SAAS,qBAAqB,SAACL,GACtDH,EAAAA,EAAcS,UAAUP,EAAAA,EAAqBJ,KAAKY,UAAUP,GAC9D,ICzBO,IAAMQ,EAA+C,CAAC,ECoKhDC,EAAkB,I,WAxJ/B,SAAAT,IACE,KAAAU,OAA8B,KAC9B,KAAAC,YAA4B,E,QAEtBX,EAAAY,UAAAC,KAAN,W,oGACMC,EAAAA,EAAeC,0BAAf,Y,iBAEA,O,sBAAA,GAAMC,KAAKC,a,OACX,OADAC,EAAAC,OACA,GAAMH,KAAKI,mB,cAAXF,EAAAC,O,+BAEAE,EAAAA,EAAOC,MAAM,iCAAkCtB,G,+BAKrDA,EAAAY,UAAAW,QAAA,SAAQvB,GACN,GAAIc,EAAAA,EAAeC,0BACjB,IACE,IAAMG,EAAaF,KAAKQ,cAAcxB,GACpBgB,KAAKS,aAAaP,GAC1BQ,U,CACV,MAAOR,GACPG,EAAAA,EAAOC,MAAM,gCAAAK,OAAgC3B,GAAkBkB,E,GAKrElB,EAAAY,UAAAgB,qBAAA,SAAqB5B,GACnB,GAAIc,EAAAA,EAAeC,0BACjB,IACE,IAAMG,EAAaF,KAAKQ,cAAcxB,EAAK6B,gBACrCC,EAAYd,KAAKS,aAAaP,GACpC,MAAuB,aAAnBY,EAAUC,KACL/B,EAAKgC,SAEPF,EAAUJ,U,CACjB,MAAOR,GACPG,EAAAA,EAAOC,MAAM,gCAAAK,OAAgC3B,EAAK6B,gBAAkBX,E,CAGxE,OAAOlB,EAAKgC,Q,EAGAhC,EAAAY,UAAAK,UAAN,W,gGACN,OAAID,KAAKN,OAAe,CAAP,EAAOuB,QAAQC,QAAQlB,KAAKN,SAE7C,GAAMM,KAAKmB,gB,OAGX,OAHAjB,EAAAC,OACMnB,EAAIoC,OACVpB,KAAKN,OAASV,EAAEqC,OACT,CAAP,EAAOrB,KAAKN,Q,QAGAV,EAAAY,UAAAQ,gBAAN,W,mFAIN,IAAWkB,KAHLtC,EAASgB,KAAKuB,YACdrB,EAAoBlB,EAAOwC,UAAUC,WACrCX,EAAyBd,KAAK0B,0BAE5BC,EAAuBb,EAAuBQ,GAC9CM,EAAa,IAAI1B,EAAkByB,GACzC3B,KAAKL,YAAYkC,KAAKD,G,iBAIpB5C,EAAAY,UAAAkC,gCAAN,W,uFACE,GAAIhC,EAAAA,EAAeC,4BACXf,EAASgB,KAAKuB,YACdrB,EAAoBlB,EAAOwC,UAAUC,WACrCX,EAAqBiB,EAAAA,EAAgBC,MAAMC,eAG/C,IAAAX,EAAA,EAAmCK,EAAAb,EAAAQ,EAAAK,EAAAO,OAAAZ,IAAxBM,EAAoBD,EAAAL,GACvBa,EAAmCP,EAAqBQ,WAAWC,KACvE,SAACrD,GAA8B,OAC7B+B,KAAM/B,EAAU+B,KAChBL,SAAU,WAAM,OAAA1B,EAAUgC,QAAV,EAFa,IAKjCmB,EAAoBN,KAAK,CACvBd,KAAM,WACNL,SAAU,WAAM,eAEZ4B,EAAa,IAAIpC,EAAiBqC,OAAAC,OAAAD,OAAAC,OAAC,CAAC,EAAIZ,GAAoB,CAAEQ,WAAYD,KAChFnC,KAAKL,YAAYkC,KAAKS,G,iBAMtBtD,EAAAY,UAAAY,cAAA,SAAcxB,GACpB,IAAMkB,EAAaF,KAAKL,YAAY8C,MAAK,SAACvC,GAAe,OAAAA,EAAWa,OAAS/B,CAApB,IACzD,IAAKkB,EAAY,MAAM,IAAIwC,EAAAA,EAAU,4BAAA/B,OAA4B3B,EAAI,UAAU2D,EAAAA,EAAeC,SAC9F,OAAO1C,C,EAGDlB,EAAAY,UAAAa,aAAA,SAAazB,GACnB,IAAMkB,EAAgBlB,EAAW6D,4BAC3B/B,EAAY9B,EAAWoD,WAAWK,MAAK,SAACzD,GAAc,OAAAA,EAAU+B,OAASb,CAAnB,IAE5D,IAAKY,EACH,MAAM,IAAI4B,EAAAA,EACR,+BAAA/B,OAA+B3B,EAAW+B,KAAI,gBAAAJ,OAAeT,EAAa,UAC1EyC,EAAAA,EAAeC,SAEnB,OAAO9B,C,EAGD9B,EAAAY,UAAA2B,UAAA,WACN,IAAKvB,KAAKN,OAAQ,MAAM,IAAIgD,EAAAA,EAAU,6CAA8CC,EAAAA,EAAeC,SACnG,OAAO5C,KAAKN,M,EAGNV,EAAAY,UAAAuB,aAAA,eAAAnC,EAAA,KACN,OAAO,IAAIiC,SAAQ,SAACf,EAASY,GAC3B,IAAMQ,EAAIwB,SAASC,cAAc,UACjCzB,EAAE0B,KAAOhE,EAAKiE,kBACdH,SAASI,KAAKC,YAAY7B,GAE1B,IAAMK,GAAeyB,EAAAA,EAAAA,GACnBN,SAASO,cAAc,oEAGrB1B,GACFA,EAAa2B,OAAS,WACpBpD,GAAQ,E,EAEVyB,EAAa4B,QAAU,WAAM,OAAAzC,EAAO,IAAI4B,EAAAA,EAAU,iCAAkCC,EAAAA,EAAeC,SAAtE,GAE7B9B,EAAO,IAAI4B,EAAAA,EAAU,4CAA6CC,EAAAA,EAAeC,S,KAK/E5D,EAAAY,UAAA8B,wBAAA,WACN,OAAOlC,C,EAGDR,EAAAY,UAAAqD,gBAAA,WACN,IAAMjE,EAAqBwE,EAAAA,EAAcxB,MAAMyB,IAC/C,MAAO,iRAAA9C,OAM4C,eAAvB3B,EAAsC,IAAM,IAAG,iO,iBC7JvD0E,IACtB,OAAOjE,CACT,C","sources":["../node_modules/@porschehn/navigation/dist/esm-es5/src/state/dealer-search-results-store.ts","../node_modules/@porschehn/navigation/dist/esm-es5/src/utility/constants/ab-testing.ts","../node_modules/@porschehn/navigation/dist/esm-es5/src/services/ab-testing/matomo-ab-testing-service.ts","../node_modules/@porschehn/navigation/dist/esm-es5/src/services/ab-testing/ab-testing-constructor-service.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\nimport { PPNDealerSearchResult } from '../entities/dealer-response';\nimport windowService from '../services/window-service';\nimport { SAVED_DEALER_COOKIE } from '../utility/constants';\n\nexport interface DealerSearchResults {\n  searchTerm: string;\n  results: string[] | null;\n  savedDealerCookie: SavedDealerCookie | null;\n  ppnDealers: { [dealerId: string]: PPNDealerSearchResult };\n  dealersOfRegion: any;\n}\n\nexport interface SavedDealerCookie {\n  id: string;\n  latitude: number;\n  longitude: number;\n}\n\nexport const dealerSearchResultsStore = createStore<DealerSearchResults>({\n  searchTerm: '',\n  results: null,\n  savedDealerCookie: readDealerCookie(),\n  ppnDealers: {},\n  dealersOfRegion: { regions: [] }\n});\n\ndealerSearchResultsStore.onChange('savedDealerCookie', (newValue) => {\n  windowService.setCookie(SAVED_DEALER_COOKIE, JSON.stringify(newValue));\n});\n\nfunction readDealerCookie(): SavedDealerCookie | null {\n  try {\n    return JSON.parse(windowService.getCookie(SAVED_DEALER_COOKIE));\n  } catch (err) {\n    return null;\n  }\n}\n","export type ExperimentDefinition = Record<string, unknown>;\n\nexport type AvailableExperiment = (typeof experimentsDefinitions)[keyof typeof experimentsDefinitions];\n\nexport const experimentsDefinitions: ExperimentDefinition = {};\n\nexport interface MatomoClient {\n  track: () => void;\n  AbTesting: {\n    Experiment: { new (definition: unknown): Experiment };\n  };\n}\n\nexport interface Experiment {\n  name: string;\n  getActivatedVariationName: () => string;\n  variations: Variation[];\n}\n\nexport interface Variation {\n  name: string;\n  activate: () => unknown;\n}\n","import { navStateStore } from '../../state/nav-state-store';\nimport { NaviError, NaviErrorTypes } from '../../utility/navi-error';\nimport { IAbTestingService } from './ab-testing-service.interface';\nimport {\n  AvailableExperiment,\n  Experiment,\n  experimentsDefinitions,\n  MatomoClient,\n  Variation\n} from '../../utility/constants/ab-testing';\nimport Logger from '../logger';\nimport { getHTMLElement } from '../../utility/helper';\nimport featureToggles from '../feature-toggles';\nimport { TMenu, VariationDefinition } from '../../entities/content';\nimport { navContentStore } from '../../state/nav-content-store';\n\nexport class MatomoAbTestingService implements IAbTestingService {\n  client: MatomoClient | null = null;\n  experiments: Experiment[] = [];\n\n  async init(): Promise<void> {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        await this.setClient();\n        await this.loadExperiments();\n      } catch (e) {\n        Logger.error('Could not initialize AbTesting', e as Error);\n      }\n    }\n  }\n\n  execute(experimentName: AvailableExperiment): void {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        const experiment = this.getExperiment(experimentName);\n        const variation = this.getVariation(experiment);\n        variation.activate();\n      } catch (e) {\n        Logger.error(`Could not execute experiment ${experimentName}`, e as Error);\n      }\n    }\n  }\n\n  executeContentChange(menu: TMenu): TMenu[] {\n    if (featureToggles.isABTestingToggleActive()) {\n      try {\n        const experiment = this.getExperiment(menu.experienceName);\n        const variation = this.getVariation(experiment);\n        if (variation.name === 'original') {\n          return menu.children;\n        }\n        return variation.activate() as unknown as TMenu[];\n      } catch (e) {\n        Logger.error(`Could not execute experiment ${menu.experienceName}`, e as Error);\n      }\n    }\n    return menu.children;\n  }\n\n  private async setClient(): Promise<MatomoClient> {\n    if (this.client) return Promise.resolve(this.client);\n\n    await this.injectScript();\n    const w = window as any;\n    this.client = w.Matomo as MatomoClient;\n    return this.client;\n  }\n\n  private async loadExperiments(): Promise<void> {\n    const client = this.getClient();\n    const ExperimentCreator = client.AbTesting.Experiment;\n    const experimentsDefinitions = this.getAbTestingDefinitions();\n    for (const experimentKey in experimentsDefinitions) {\n      const experimentDefinition = experimentsDefinitions[experimentKey];\n      const experiment = new ExperimentCreator(experimentDefinition);\n      this.experiments.push(experiment);\n    }\n  }\n\n  async loadContentGeneratorExperiments(): Promise<void> {\n    if (featureToggles.isABTestingToggleActive()) {\n      const client = this.getClient();\n      const ExperimentCreator = client.AbTesting.Experiment;\n      const contentDefinitions = navContentStore.state.abExperiences;\n\n      if (contentDefinitions) {\n        for (const experimentDefinition of contentDefinitions) {\n          const variationDefinition: Variation[] = experimentDefinition.variations.map(\n            (variation: VariationDefinition) => ({\n              name: variation.name,\n              activate: () => variation.children\n            })\n          );\n          variationDefinition.push({\n            name: 'original',\n            activate: () => null\n          });\n          const experiment = new ExperimentCreator({ ...experimentDefinition, variations: variationDefinition });\n          this.experiments.push(experiment);\n        }\n      }\n    }\n  }\n\n  private getExperiment(name: AvailableExperiment): Experiment {\n    const experiment = this.experiments.find((experiment) => experiment.name === name);\n    if (!experiment) throw new NaviError(`No experiment with name: ${name} found`, NaviErrorTypes.GENERAL);\n    return experiment;\n  }\n\n  private getVariation(experiment: Experiment): Variation {\n    const variationName = experiment.getActivatedVariationName();\n    const variation = experiment.variations.find((variation) => variation.name === variationName);\n\n    if (!variation)\n      throw new NaviError(\n        `No variation in experiment: ${experiment.name} with name: ${variationName} found`,\n        NaviErrorTypes.GENERAL\n      );\n    return variation;\n  }\n\n  private getClient(): MatomoClient {\n    if (!this.client) throw new NaviError('No client is set, you must call init first', NaviErrorTypes.GENERAL);\n    return this.client;\n  }\n\n  private injectScript(): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      const s = document.createElement('script');\n      s.text = this.getMatomoScript();\n      document.head.appendChild(s);\n\n      const matomoScript = getHTMLElement(\n        document.querySelector('script[src=\"//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js\"]')\n      );\n\n      if (matomoScript) {\n        matomoScript.onload = () => {\n          resolve(true);\n        };\n        matomoScript.onerror = () => reject(new NaviError('Could not inject Matomo script', NaviErrorTypes.GENERAL));\n      } else {\n        reject(new NaviError('There is no HTML Script element available', NaviErrorTypes.GENERAL));\n      }\n    });\n  }\n\n  private getAbTestingDefinitions() {\n    return experimentsDefinitions;\n  }\n\n  private getMatomoScript(): string {\n    const currentEnvironment = navStateStore.state.env;\n    return `var _paq = window._paq = window._paq || [];\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    (function() {\n      var u=\"https://porsche.matomo.cloud/\";\n      _paq.push(['setTrackerUrl', u+'matomo.php']);\n      _paq.push(['setSiteId', ${currentEnvironment === 'production' ? '7' : '8'}]);\n      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n      g.async=true; g.src='//cdn.matomo.cloud/porsche.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);\n    })\n   ();`;\n  }\n}\n\nexport const MatomoAbTesting = new MatomoAbTestingService();\n","import { IAbTestingService } from './ab-testing-service.interface';\nimport { MatomoAbTesting } from './matomo-ab-testing-service';\n\nexport default function abTestingService(): IAbTestingService {\n  return MatomoAbTesting;\n}\n"],"names":["dealerSearchResultsStore","createStore","searchTerm","results","savedDealerCookie","JSON","parse","windowService","getCookie","SAVED_DEALER_COOKIE","e","readDealerCookie","ppnDealers","dealersOfRegion","regions","onChange","setCookie","stringify","experimentsDefinitions","MatomoAbTesting","client","experiments","prototype","init","featureToggles","isABTestingToggleActive","this","setClient","t","sent","loadExperiments","logger","error","execute","getExperiment","getVariation","activate","concat","executeContentChange","experienceName","r","name","children","Promise","resolve","injectScript","window","Matomo","n","getClient","AbTesting","Experiment","getAbTestingDefinitions","i","o","push","loadContentGeneratorExperiments","navContentStore","state","abExperiences","length","a","variations","map","s","Object","assign","find","NaviError","NaviErrorTypes","GENERAL","getActivatedVariationName","document","createElement","text","getMatomoScript","head","appendChild","getHTMLElement","querySelector","onload","onerror","navStateStore","env","abTestingService"],"sourceRoot":""}